# FreeSpeak 产品需求文档（PRD）
Free speak 功能是原AI草稿功能的升级。

## 1. 功能范围

### 1.1 核心功能模块

| 模块 | 功能描述 |
|------|----------|
| 中文语音录制 | 用户录制中文语音，系统实时转写为文字 |
| AI 翻译 | 将中文文本自动翻译为自然英文 |
| 英文跟读 | 用户录制英文跟读音频 |
| 朗读播放 | 播放英文标准发音供参考 |
| 笔记收藏 | 将练习内容保存至学习记录 |
| 文本编辑 | 用户可手动修改中文原文并触发重新翻译 |

### 1.2 入口形态

对话窗口左下角，FreeSpeak 就是原 AI 草稿功能的升级。

---

## 2. 用户流程

### 2.1 主流程

```
用户点击 FreeSpeak 按钮
        ↓
底部浮层弹出（步骤 1）
        ↓
用户点击录音按钮 → 开始录制中文语音
        ↓
实时显示语音识别文字
        ↓
用户再次点击录音按钮 → 停止录制
        ↓
系统处理（转写 + 翻译）
        ↓
进入步骤 2：展示中文原文 + 英文翻译
        ↓
用户可选：朗读参考 / 添加到笔记 / 编辑原文
        ↓
用户点击"开始跟读" → 录制英文跟读
        ↓
用户再次点击 → 停止录制
        ↓
用户可选：试听录音 / 重新录制
        ↓
用户点击"发送" → 完成本次练习，浮层关闭
```

### 2.2 辅助流程：编辑原文重新翻译

```
步骤 2 中，用户点击中文文本区域
        ↓
文本进入编辑状态
        ↓
用户修改内容后失焦（点击其他区域或按 Enter）
        ↓
系统触发重新翻译
        ↓
英文翻译区域更新，修改完中文之后，英文部分会用省略号显示调用状态，调用API翻译成功之后，显示新的文案即可。
```

---

## 3. 详细功能需求

### 3.1 底部浮层（Bottom Sheet）

**触发与关闭**

- 点击底部工具栏"FreeSpeak"按钮，浮层从底部滑入
- 点击浮层右上角关闭按钮，浮层收起
- 点击浮层外部遮罩区域，浮层收起
- 浮层关闭后，自动重置内部状态至初始步骤


### 3.2 步骤 1：中文语音录制

**录音控制**

- 页面中央展示一个圆形录音按钮
- 首次进入时，按钮下方提示文字为"点击开始录音"
- 点击按钮后进入录音状态：
  - 按钮样式切换为"录音中"状态（视觉反馈）
  - 提示文字变更为"录音中..."
  - 标题区域开始实时显示语音识别结果（逐字追加）
- 再次点击按钮停止录音：
  - 按钮恢复默认样式
  - 标题区域显示完整识别文字
  - 提示文字短暂变更为"处理中..."
  - 约 1 秒后自动跳转至步骤 2

**实时转写展示**

- 语音识别尽量调用流式输出，实时显示用户正在说的内容。
- 停止录音后，标题区域立即显示完整文本（不等待逐字完成）

---

### 3.3 步骤 2：翻译与跟读练习

#### 3.3.1 内容展示

- **中文原文卡片**：展示步骤 1 识别的中文文本，带编辑图标
- **英文翻译卡片**：展示 AI 翻译结果，视觉上与中文卡片有明显区分

#### 3.3.2 中文原文编辑

- 点击中文卡片任意区域（编辑图标除外）进入编辑模式
- 编辑模式下：
  - 文本框获得焦点，可直接修改内容
  - 编辑图标隐藏
  - 文本框边框高亮
- 退出编辑模式（失焦或按 Enter）：
  - 触发重新翻译
  - 英文翻译卡片内容更新
  - 显示 Toast 提示"翻译已更新"
- 若编辑后内容为空，不触发翻译，保留原有翻译结果

#### 3.3.3 朗读功能

- 点击"朗读"按钮，播放英文翻译的标准发音
- 播放期间显示 Toast 提示"正在朗读英文"
- 朗读与跟读录音不可同时进行（互斥）

#### 3.3.4 笔记功能（AI snippet）

- 点击"添加到笔记"按钮，也就是保存到AI笔记（AI snippet）

#### 3.3.5 跟读录音

**录音控制**

- 初始状态：按钮文字为"开始跟读"，状态提示为"点击下方按钮开始跟读"
- 点击"开始跟读"后进入录音状态：
  - 按钮文字动态变化（"录音中."、"录音中.."、"录音中..."循环）
  - 按钮样式切换为录音中状态
  - 状态提示变更为"正在录音"
- 再次点击停止录音：
  - 按钮文字变更为"发送"
  - 按钮样式切换为完成状态
  - 状态提示变更为"录音完成，点击发送"
  - 出现"重新录制"和"试听录音"两个辅助按钮

**试听录音**

- 点击"试听录音"，播放用户刚录制的跟读音频
- 播放期间显示 Toast 提示"正在播放录音"

**重新录制**

- 点击"重新录制"，清除当前录音，恢复至跟读初始状态
- 辅助按钮（试听/重新录制）隐藏
- 可重新开始录音

**发送**

- 点击"发送"按钮，将该语音发送到对话当中。


---

### 3.4 Toast 通知

- Toast 从页面顶部滑入，2 秒后自动消失
- 同一时间只展示一条 Toast，新 Toast 出现时覆盖旧 Toast
- Toast 不可点击，不阻断用户操作

---

## 4. 边界情况与异常处理

### 4.1 录音相关

| 场景 | 期望行为 |
|------|----------|
| 用户点击录音后立即停止（录音时长极短，< 0.5s） | 提示"录音时间过短，请重试"，不进入步骤 2 |
| 录音过程中语音识别无结果（静音或噪音） | 停止录音后提示"未识别到内容，请重试"，停留在步骤 1 |
| 跟读录音时长为 0（点击开始后立即停止） | 提示"录音时间过短"，不显示"发送"按钮，恢复初始状态 |

### 4.2 翻译相关

使用跟原AI草稿相同的翻译提示词。

### 4.3 网络相关

| 场景 | 期望行为 |
|------|----------|
| 无网络时点击录音 | 提示"当前无网络连接，语音识别需要网络支持" |
| 录音过程中断网 | 停止录音后提示"网络已断开，识别失败，请检查网络后重试" |
| 发送跟读时断网 | 提示"发送失败，请检查网络后重试"，保留录音数据，允许重新发送 |
| 弱网环境下翻译响应慢 | 显示加载状态，超过 10s 后提示超时 |

### 4.4 浮层交互相关

| 场景 | 期望行为 |
|------|----------|
| 录音进行中点击关闭按钮 | 弹出确认弹窗："录音将被丢弃，确认关闭？"，用户确认后关闭并重置 |
| 录音进行中点击遮罩区域 | 同上，弹出确认弹窗 |
| 步骤 2 中点击关闭按钮（已有翻译结果） | 直接关闭，不需要确认（内容未提交，属于轻量操作） |
| 步骤 2 中跟读录音进行中点击关闭 | 弹出确认弹窗："跟读录音将被丢弃，确认关闭？" |
| 浮层打开时键盘弹起（编辑中文时） | 浮层上移，确保编辑区域不被键盘遮挡 |
| 快速连续点击"FreeSpeak"按钮 | 防抖处理，只触发一次浮层打开 |

### 4.5 笔记功能相关

| 场景 | 期望行为 |
|------|----------|
| 重复添加相同内容到笔记 | ，点击添加到笔记按钮后，按钮文案会变成“已添加到笔记”，同时弹出提示框（toast）提示"该内容已在笔记中" |
| 添加笔记时网络异常 | 提示"保存失败，请稍后重试" |

### 4.6 文本编辑相关

| 场景 | 期望行为 |
|------|----------|
| 编辑中文时粘贴大量文本（> 200 字） | 截断至 200 字并提示"内容过长，已截取前 200 字" |
| 编辑中文时输入纯英文 | 正常翻译（英译中或保留），不报错 |
| 编辑中文时按 Enter 换行 | 阻止换行，触发失焦并提交编辑 |

---



## 5. 术语表

| 术语 | 说明 |
|------|------|
| Bottom Sheet | 从屏幕底部滑出的浮层面板 |
| 跟读 | 用户模仿标准发音录制英文音频的练习行为 |
| Toast | 短暂出现后自动消失的轻量级通知提示 |
| 实时转写 | 录音过程中同步将语音转换为文字的能力 |
| 朗读 | 系统播放英文文本的 TTS（文字转语音）功能 |

---

*本文档由产品团队维护，如有疑问请联系产品负责人。*
